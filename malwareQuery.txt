0. Clean database.
delete from callerComp;
delete from edge;
delete from flow;
delete from iccg;
delete from intentFilter;
delete from node;
delete from permission;



1. DroidDreamLight:

select node_id,  full_name, tgtId from ( (select node_id, e.tgt_node_id as tgtId from intentFilter ift,  edge e where ift.iccg_id=8 and (ift.name like '%PHONE_STATE%') and e.src_node_id=ift. node_id)  as tmp,

(SELECT  distinct f1.src_node_id as serviceId  FROM flow f1, flow f2, flow f3 where f1.iccg_id=8 and f2.iccg_id=8 and f3.iccg_id=8 and f1.src_node_id=f2.src_node_id and f2.src_node_id=f3.src_node_id and f1.source='$getDeviceId' and f1.sink='!INTERNET' and  f2.source='$InstalledPackages' and f2.sink='!INTERNET' and  f3.source='$getSubscriberId' and f3.sink='!INTERNET' ) as tmp2,

 node as nd) where node_id=nd.id and nd.type='receiver' and serviceId=tgtId

 2. Kungfu3:

receiver->service(leak data)->activity

  select node_id as recv_id, tgtId as serviceId, tgt_node_id as activity_id from (
  /*receiver a will launch b*/
  select node_id,  full_name, tgtId from ( (select node_id, e.tgt_node_id as tgtId from intentFilter ift,  edge e where ift.iccg_id=55 and (ift.name like '%BOOT_COMPLETE%') and e.src_node_id=ift. node_id)  as tmp,

  /*service  b that generates src-sink*/
  (SELECT  distinct f1.src_node_id as serviceId  FROM flow f1, flow f2, flow f3, flow f4 where f1.iccg_id=55 and f2.iccg_id=55 and f3.iccg_id=55 and f4.iccg_id=55 and f1.src_node_id=f2.src_node_id and f2.src_node_id=f3.src_node_id and f3.src_node_id=f4.src_node_id and f1.source='$getDeviceId' and f1.sink='!INTERNET' and  f2.source='$getLine1Number' and f2.sink='!INTERNET' and  f3.source='$MODEL' and f3.sink='!INTERNET' and f4.source='$BRAND' and f4.sink='!INTERNET' ) as tmp2,

  /*service b launches activity c. */
   node as nd) where node_id=nd.id and nd.type='receiver' and serviceId=tgtId) as tmp3, edge as eg, node as activity where eg. src_node_id=tgtId and eg.tgt_node_id=activity.id and activity.type='activity'



3. Geinimi

receiver->service(self loop and leak data)


  select  node_id as recv_id, tgtId as serviceId, tgt_node_id as activity_id from (
    /*receiver a will launch b*/
      select node_id,  full_name, tgtId from ( (select node_id, e.tgt_node_id as tgtId from intentFilter ift,  edge e where ift.iccg_id=56 and (ift.name like '%BOOT_COMPLETE%') and e.src_node_id=ift. node_id)  as tmp,

        /*service  b that generates src-sink*/
          (SELECT  distinct f1.src_node_id as serviceId  FROM flow f1, flow f2, flow f3, flow f4 where f1.iccg_id=56 and f2.iccg_id=56 and f3.iccg_id=56 and f4.iccg_id=56 and f1.src_node_id=f2.src_node_id and f2.src_node_id=f3.src_node_id and f3.src_node_id=f4.src_node_id and f1.source='$getDeviceId' and f1.sink='!INTERNET' and  f2.source='$getLine1Number' and f2.sink='!INTERNET' and  f3.source='$MODEL' and f3.sink='!INTERNET' and f4.source='$BRAND' and f4.sink='!INTERNET' ) as tmp2,

            /*service b launches  itself. */
               node as nd) where node_id=nd.id and nd.type='receiver' and serviceId=tgtId) as tmp3, edge as eg, node as self where eg. src_node_id=tgtId and eg.tgt_node_id=tgtId and self.type='service' and self.id=tgtId


4. GoldDream

receiver->service

/*Receiver launches service.*/
select node_id,  full_name, tgtId from ( (select node_id, e.tgt_node_id as tgtId from intentFilter ift,  edge e where ift.iccg_id=58 and ( ift.name like '%PHONE_STATE%' and ift.name like '%BOOT_COMPLETED%' and ift.name like '%SMS_RECEIVED%' and ift.name like '%NEW_OUTGOING_CALL%') and e.src_node_id=ift. node_id)  as tmp, 
(   /*Service leaks data*/
SELECT  distinct f1.src_node_id as serviceId  FROM flow f1, flow f2, flow f3 where f1.iccg_id=58 and f2.iccg_id=58 and f3.iccg_id=58 and f1.src_node_id=f2.src_node_id and f2.src_node_id=f3.src_node_id and f1.source='$getDeviceId' and f1.sink='!INTERNET' and  f2.source='$getSimSerialNumber' and f2.sink='!INTERNET' and  f3.source='$getSubscriberId' and f3.sink='!INTERNET' 
) as tmp2,

 node as nd) where node_id=nd.id and nd.type='receiver' and serviceId=tgtId


 5. ADRD

receiver -> receiver <-> service



