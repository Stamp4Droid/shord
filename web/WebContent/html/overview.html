<!DOCTYPE html>
<html lang="en" class="fuelux">
  <head>
	<link href="/stamp/fuelux/css/fuelux.min.css" rel="stylesheet" />
	
	<style type="text/css">
	  body {
	  padding-top: 60px;
	  padding-bottom: 20px;
      }
      
      .source-view {height:80vh; overflow:auto; resize:auto;}
      .right-view {overflow:auto; }
      
      .fuelux .nav-tabs > li > a {
      padding-top: 0px;
      padding-bottom: 5px;
      line-height: 10px;
      }
 
      .bar {
      height: 8px;
      }
      
      table.appslist td.status {
      text-align: right;
      }
	</style>

	<link href="/stamp/fuelux/css/fuelux-responsive.min.css" rel="stylesheet" />
	<link rel="stylesheet" href="../fileupload/jquery.fileupload-ui.css">
	
  </head>	  

  <body>
	<!-- navigation bar -->
	<div class="navbar navbar-inverse navbar-fixed-top">
	  <div class="navbar-inner">
	    <div class="container">

	      <ul class="nav pull-left">
		<li><a class="brand" href="#">STAMP&alpha;-APK</a></li>
	      </ul>

	      <ul class="nav pull-left">
		<li>
		  <form id="fileupload" action="../fileUpload" method="POST" enctype="multipart/form-data">
		    <span class="btn btn-success fileinput-button">
		      <i class="icon-plus icon-white"></i>
		      <span>Analyze</span>
		      <input type="file" name="files[]" multiple>
		    </span>
		  </form>
		</li>
	      </ul>

	      <ul class="nav pull-left">
		<li>
		  <form id="fileupload" action="../fileUpload" method="POST" enctype="multipart/form-data">
		    <span class="btn btn-warning fileinput-button">
		      <i class="icon-plus icon-white"></i>
		      <span>Map</span>
		      <input type="file" name="files[]" multiple>
		    </span>
		  </form>
		</li>
	      </ul>

	      <!-- <ul class="nav"> -->
	      <!-- 	<\!-- Settings -\-> -->
	      <!-- 	<li class="dropdown"> -->
	      <!-- 	  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Settings <b class="caret"></b></a> -->
	      <!-- 	  <ul class="dropdown-menu"> -->
	      <!-- 	    <li><a onClick="toggleClass()">Toggle Class</a></li> -->
	      <!-- 	    <li><a onClick="toggleFlows()">Toggle Flows</a></li> -->
	      <!-- 	    <li><a onClick="toggleWarnings()">Toggle Warnings</a></li> -->
	      <!-- 	  </ul> -->
	      <!-- 	</li> -->
	      <!-- </ul> -->
	      
	      <ul class="nav">
		<!-- Help -->
		<li class="dropdown">
		  <a href="#" class="dropdown-toggle" data-toggle="dropdown">Help <b class="caret"></b></a>
		  <ul class="dropdown-menu">
		    <!-- <li><a href="/doc/stamp.html" target="_blank">Docs</a></li> -->
		    <li><a href="http://www.youtube.com/user/STAMPStanford" target="_blank">Video Tutorials</a></li>
		  </ul>
		</li>
	      </ul>

	    </div>
 	  </div>
	</div> 

	
	<!-- content -->
	<div class="container-fluid">
	  <div class="row-fluid">

	    <!--Sidebar content-->
 	    <div class="span3">
	      <table id="appslist" class="table table-striped appslist">
		<tbody>
		</tbody>
	      </table>
	    </div>

	    <!-- Main content -->
	    <div class="span6">

	      <table class="table table-condensed table-hover" id="reportheader">
		<th>Risk Report for PrivacyLeakMain.apk &nbsp <a href=""><i class="icon-refresh"></a></i> &nbsp <a href=""><i class="icon-download"></a></i></th>
		<tr></tr>
	      </table>

	      <table class="table table-condensed table-hover" id="incident-summary"><th>Incidents</th><th>Risk Type</th>
		<tr><td>5</td><td><a href="">Privacy Violations</a></td></tr> 
		<tr><td>3</td><td><a href="">Confidentiality Risks</a></td></tr>
		<tr><td>7</td><td><a href="">Integrity Risks</a></td></tr>
		<tr><td>31</td><td><a href="">Low Risk</a></td></tr>
		<tr><td>11</td><td><a href="">Analysis Warnings</a></td></tr>
	      </table>

	      <table class="table table-condensed table-hover" id="privacy-rpt"><th colspan="7">Privacy - PII sent off device </th>
	      	<tr><td>Device Identifier</td><td><i class="icon-arrow-right"></i></td><td>sendUDP(www.symc.com)</td>
		  <td><span class="label label-important">Unencrypted</span></td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
		<tr><td>content://contacts</td><td><i class="icon-arrow-right"></i></td><td>sendSocket(192.168.0.1)</td>
		  <td><span class="label label-success">Encrypted</span></td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      	<tr><td>content://sms</td><td><i class="icon-arrow-right"></i></td><td>HttpPOST(33.44.55.66)</td>
		  <td><span class="label label-success">Hashed</span></td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      </table>

	      <table class="table table-condensed table-hover" id="conf-rpt"><th colspan="7">Confidentiality - Unencrypted data sent off device</th>
	      	<tr><td>content://sms</td><td><i class="icon-arrow-right"></i></td><td>HttpPOST(33.44.55.66)</td>
		  <td><i class="icon-search"></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td></tr>
	      	<tr><td>Device Identifier</td><td><i class="icon-arrow-right"></i></td><td>sendUDP(www.symc.com)</td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      </table>

	      <table class="table table-condensed table-hover" id="integrity-rpt"><th colspan="5">Integrity - Untrusted data flowing to sensitive APIs</th>
		<tr><td>3</td><td><a href="">Data Corruption</a></td>
		  <td><i class="icon-search"></i></td>		  
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
		<tr><td>7</td><td><a href="">Data Injection</a></td>
		  <td><i class="icon-search"></i></td>		  
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
		<tr><td>11</td><td><a href="">Others</a></td>
		  <td><i class="icon-search"></i></td>		  
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      </table>

	      <table class="table table-condensed table-hover" id="lowrisk-rpt"><th colspan="5">Low Risk Dataflow - Data accessed, but remains on device</th>
		<tr><td>2</td><td><a href="">On Device Flows</a></td>
		  <td><i class="icon-search"></i></td>		  
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      </table>

	      <table class="table table-condensed table-hover" id="warn-rpt"><th colspan="5">Analysis Warnings - Sources of unsoundness</th>
	      	<tr><td>5</td><td><a href="">Dynamic Code Loading</a></td>
		  <td><i class="icon-search"></i></td>		  
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr> 
		<tr><td>3</td><td><a href="">Reflection</a></td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
		<tr><td>2</td><td><a href="">Others</a></td>
		  <td><i class="icon-search"></i></td>
		  <td><i class="icon-ok"></i></td>
		  <td><i class="icon-ban-circle"></i></td>
		</tr>
	      </table>

	      <table class="table table-condensed table-hover" id="coverage-rpt"><th>Coverage</th><th>Analysis Type</th>
		<tr><td>100%</td><td><a href="">Static data flow analysis (statement)</a></td></tr> 
		<tr><td>28%</td><td><a href="">Statically Reachable Sources (Dynamic)</a></td></tr>
		<tr><td>63%</td><td><a href="">Statically Reachable Sinks (Dynamic)</a></td></tr>
		<tr><td>63%</td><td><a href="">Basic Blocks (Dynamic)</a></td></tr>
	      </table>

	    </div>
	    <!-- <div class="accordion" id="accordionFlows"> -->
	      <!-- </div> -->

	      <div class="span3 right-view" id="rightbar">

		<table class="table table-condensed table-hover" id="warnings"><th colspan="2">Flow Details</th>
		  <tr><td>Category:</td><td>Privacy</td></tr>
	      	  <tr><td>Flow:</td><td>content://sms <i class="icon-arrow-right"></i> HttpPOST</td></tr>
		  <tr><td>Modifiers:</td><td><span class="label label-success">Hashed</span></td></tr>
		  <tr><td>Source Component:</td><td>App</td></tr> 
		  <tr><td>Source Params:</td><td>None</td></tr>
		  <tr><td>Sink Component:</td><td>Ad library</td></tr>
		  <tr><td>Sink Params:</td><td>33.44.55.66</td></tr>
		  <tr><td>Misc:</td><td><i class="icon-question-sign"></i> &nbsp <i class="icon-search"></i></td></tr>
		</table>

	      </div>
	      
	</div>
	
	<div class="modal hide fade" id="errormsgs-modal">
		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			<h3>Only files with .apk extensions can be uploaded. The following files were ignored:</h3>
		</div>
		<div class="modal-body">
			<ul class="unstyled" id="errormsgs">
		  	</ul>
		</div>
	</div>
	
	<script src="/stamp/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
	<script src="/stamp/fuelux/loader.js" type="text/javascript"></script>
	<script src="../jquery-ui/jquery.ui.widget.js"></script>
	<script src="../fileupload/jquery.iframe-transport.js"></script>
	<script src="../fileupload/jquery.fileupload.js"></script>
	<script src="/stamp/scripts/processMsg.js"></script>
    <script src="/stamp/scripts/parseApk.js"></script>

	<script>
		var apkIdToRow = new Object();
		
	  $(function () {
		  
        'use strict';

        $('#fileupload').fileupload({
          url: '../fileUpload',

          maxFileSize: 15000000,
          
          add: function (e, data) {
        	//alert('hellp');
        	var file = data.files[0];
        	if(file.name.match(/\.apk$/)){
        		var row = $('<tr><td>'+file.name+'</td><td class="status"><div class="progress progess-striped" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><div class="bar bar-success" style="width: 10%;"></div></div></td></tr>');
        		apkIdToRow[file.name+file.size] = row;
        		data.context = row.appendTo('#appslist > tbody:last');
    			data.submit();
        	} else {
        		$('<li>'+file.name+'</li>').appendTo('#errormsgs');
        		$('#errormsgs-modal').modal('show');
        	}
          },
			
          progress: function (e, data) {
                if (data.context) {
                    var progress = Math.floor(data.loaded / data.total * 100);
                    data.context.find('.progress')
                        .attr('aria-valuenow', progress)
                        .find('.bar').css(
                            'width',
                            progress + '%'
                        );
                }
          },
          
          done: function (e,data) {
        	  data.context.find('.progress').replaceWith('<span class="label">Uploaded</span>');
          }
          
        });
	  });
	</script>
	
	<script>
	  var ws = new WebSocket("ws://localhost:8080/stamp/pushupdates");
	  ws.onmessage = processMessage;
	</script>
	
  </body>
</html>
