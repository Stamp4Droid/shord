<!DOCTYPE html>
<html lang="en" class="fuelux">
	<head>
		<link href="/stamp/fuelux/css/fuelux.min.css" rel="stylesheet" />
		
		<style type="text/css">
		  body {
				padding-top: 60px;
				padding-bottom: 20px;
		  }

          .table tbody tr td.danger {
             background-color: #F5A9A9;
		  }

          .table tbody tr td.success {
             background-color: #BCF5A9;
		  }
  		</style>
  		
		<link href="/stamp/fuelux/css/fuelux-responsive.min.css" rel="stylesheet" />
	</head>

	<body>
	  <div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
		  <div class="container">
			<ul class="nav pull-left">
			  <li><a class="brand" href="#">STAMP&alpha;</a></li>
			</ul>
		  </div>
		</div>
	  </div>
	  <div class="container-fluid">
		<div class="row-fluid">
		  <div class="span2">
		  </div>
 		  <div class="span8" id="summarytable">
			<table id="appsdata" class="table table-bordered">
			  <tbody>
			  </tbody>
			</table>
		  </div>
		  <div class="span2">
		  </div>
		</div>
	  </div>
	  
	  <script src="/stamp/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
	  <script src="/stamp/fuelux/loader.js" type="text/javascript"></script>

	  <script>
		function getParameterByName(name) {
          var match = RegExp('[?&]' + name + '=([^&]*)').exec(window.location.search);
          return match && decodeURIComponent(match[1].replace(/\+/g, ' '));
	    }
		
        $(function() {
		
          'use strict';
		
          $.ajax({
            type: "GET",
            url: "../dbreader",
            data: {dbpath: getParameterByName("dbpath"), formatfilepath: getParameterByName("format")},
            dataType: "json",
            success: function(rows) {
              var header = '<tr><th>SHA256</th><th>APK Name</th>';
		      var datatypes = rows[0];
		      for (var j in datatypes) { 
                  header += '<th>'+ datatypes[j] + '</th>';
              }
              header += '<th>Privacy Violation Index (PVI)</th>'
		      header += '</tr>';
		      $(header).appendTo('#appsdata > tbody:last');

		      var numrows = rows.length;
              for (var i = 1; i < numrows; i++) {
                var row = rows[i];

                var sha = row.sha;
		        var shortsha = sha.substring(0,4);
		        shortsha += '...';
		        shortsha += sha.substring(sha.length-5);

		        var html =  '<tr><td><a href="#" data-toggle="tooltip" title="'+sha+'">'+ shortsha + '</a></td>' + '<td>' + row.app + '</td>';
                var flows = row.flows;
                var numflows = 0;
		        for (var f in flows) {
                  if(flows[f] == 1) {
                    html += '<td class="danger">';
					numflows++;
                  } else
                    html += '<td class="success">';
		          html += '</td>';
		        }
                var pvi = Math.round((numflows/flows.length)*10);
                html += '<td><span class="badge badge-important">'+pvi+'</span></td>';
                html += '</tr>';
		        $(html).appendTo('#appsdata > tbody:last');
                console.log(row.app);
              }
            }
          });

        });
      </script>
	</body>
</html>
