<?xml version="1.0" encoding="UTF-8"?>
<project name="STAMP-Macros" default="help">

  <taskdef resource="net/sf/antcontrib/antcontrib.properties"
	   classpath="${stamp.dir}/lib/ant-contrib.jar"/>

  <macrodef name="require-prop">
    <!-- Fail if a property is not defined. -->
    <attribute name="property"/>
    <attribute name="description"/>
    <sequential>
      <fail message="Property @{property} (@{description}) not defined: Use -D@{property}=..."
	    unless="@{property}"/>
    </sequential>
  </macrodef>

  <macrodef name="require-ref">
    <!-- Fail if a reference doesn't exist. -->
    <attribute name="refid"/>
    <attribute name="description"/>
    <sequential>
      <if>
	<not><isreference refid="@{refid}"/></not>
	<then><fail message="Required reference @{refid} (@{description}) is missing"/></then>
      </if>
    </sequential>
  </macrodef>

  <macrodef name="prop-default">
    <!-- Set a property to a default value and print an informational message,
	 unless the property is already defined. -->
    <attribute name="property"/>
    <attribute name="default"/>
    <attribute name="description"/>
    <sequential>
      <if>
	<not><isset property="@{property}"/></not>
	<then>
	  <property name="@{property}" value="@{default}"/>
	  <echo>Using default value "@{default}" for property @{property} (@{description})</echo>
	</then>
      </if>
    </sequential>
  </macrodef>

  <macrodef name="prop-ite">
    <!-- Set a property to one of two values, depending on the value of a
	 condition. -->
    <attribute name="property"/>
    <attribute name="condition"/>
    <attribute name="then"/>
    <attribute name="else"/>
    <sequential>
      <if>
	<istrue value="@{condition}"/>
	<then><property name="@{property}" value="@{then}"/></then>
	<else><property name="@{property}" value="@{else}"/></else>
      </if>
    </sequential>
  </macrodef>

  <macrodef name="require-file">
    <!-- Fail if a file doesn't exist. -->
    <attribute name="file"/>
    <sequential>
      <fail message="File @{file} doesn't exist">
	<condition>
	  <not>
	    <resourceexists>
	      <file file="@{file}"/>
	    </resourceexists>
	  </not>
	</condition>
      </fail>
    </sequential>
  </macrodef>

  <macrodef name="require-ext">
    <!-- Fail if a filename does not have the required extension. -->
    <attribute name="file"/>
    <attribute name="extension"/>
    <sequential>
      <fail message="@{file} missing required extension \.@{extension}">
	<condition>
	  <not>
	    <matches string="@{file}" pattern="^.*\.@{extension}$"/>
	  </not>
	</condition>
      </fail>
    </sequential>
  </macrodef>

  <macrodef name="strip-ext">
    <!-- Remove the specified extension from a filename, and optionally change
	 its directory. -->
    <attribute name="file"/>
    <attribute name="destdir" default=""/>
    <attribute name="extension"/>
    <attribute name="property"/>
    <sequential>
      <if>
	<equals arg1="@{destdir}" arg2=""/>
	<then><dirname property="@{property}.dir" file="@{file}"/></then>
	<else><property name="@{property}.dir" location="@{destdir}"/></else>
      </if>
      <basename property="@{property}.base" file="@{file}"
		suffix="@{extension}"/>
      <property name="@{property}"
		location="${@{property}.dir}/${@{property}.base}"/>
    </sequential>
  </macrodef>
</project>
