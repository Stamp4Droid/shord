<?xml version="1.0" encoding="UTF-8"?>
<project name="STAMP-SolverGen">

  <target name="-prepare-backend-solvergen">
    <property name="stamp.solvergen.analysis.version" value="cfg"/>
    <property name="stamp.solvergen.analysis.class" value="_ree"/>
    <property name="stamp.solvergen.analysis.pri" value="s-r-pet-lace:a"/>
    <property name="stamp.solvergen.analysis.sec" value="null:a"/>

    <!-- Prepare SolverGen I/O directories. -->
    <property name="stamp.solvergen.indir"
	      location="${stamp.out.dir}/input/${stamp.solvergen.analysis.class}"/>
    <mkdir dir="${stamp.solvergen.indir}"/>
    <property name="stamp.solvergen.outdir"
	      location="${stamp.out.dir}/output/${stamp.solvergen.analysis.version}#${stamp.solvergen.analysis.class}@${stamp.solvergen.analysis.pri}^${stamp.solvergen.analysis.sec}"/>
    <mkdir dir="${stamp.solvergen.outdir}"/>

    <!-- Register backend-specific analyses. -->
    <property name="stamp.analyses.main"
	      value="cfl-flat-dlog,facts-dumper-java,cfl-solver-runner-java,dat-rel-parser-java"/>

    <!-- Set backend-specific system properties. -->
    <!-- Facts Dumper options -->
    <property name="stamp.dumper.templates.dir"
	      location="${stamp.dir}/solvergen/input"/>
    <property name="stamp.dumper.outdir"
	      location="${stamp.out.dir}/input"/>
    <property name="stamp.dumper.accrange.printindex" value="false"/>
    <!-- Solver Runner options -->
    <property name="stamp.solvergen.script"
	      location="${stamp.dir}/solvergen/run_solver.sh"/>
    <!-- DAT Parser options -->
    <property name="stamp.datparser.indir"
	      location="${stamp.solvergen.outdir}"/>
    <property name="stamp.datparser.templatesdir"
	      location="${stamp.dir}/solvergen/output/${stamp.solvergen.analysis.class}"/>
    <!-- Paths Adapter options -->
    <require-prop property="stamp.paths.schema"
		  description="schema file used to validate SolverGen paths XML file"/>
    <property name="stamp.paths.raw"
	      location="${stamp.solvergen.outdir}/Src2Sink.paths.xml"/>
    <property name="stamp.paths.normal"
	      location="${stamp.solvergen.outdir}/Src2Sink.paths.normal.xml"/>
    <property name="stamp.paths.flat"
	      location="${stamp.solvergen.outdir}/Src2Sink.paths.flat.txt"/>

    <!-- Register backend-specific system properties. -->
    <propertyset id="stamp.analyses.main.sysprops">
      <propertyref name="stamp.dumper.templates.dir"/>
      <propertyref name="stamp.dumper.outdir"/>
      <propertyref name="stamp.dumper.accrange.printindex"/>
      <propertyref name="stamp.solvergen.analysis.version"/>
      <propertyref name="stamp.solvergen.analysis.class"/>
      <propertyref name="stamp.solvergen.analysis.pri"/>
      <propertyref name="stamp.solvergen.analysis.sec"/>
      <propertyref name="stamp.solvergen.script"/>
      <propertyref name="stamp.datparser.indir"/>
      <propertyref name="stamp.datparser.templatesdir"/>
      <propertyref name="stamp.paths.schema"/>
      <propertyref name="stamp.paths.raw"/>
      <propertyref name="stamp.paths.normal"/>
      <propertyref name="stamp.paths.flat"/>
    </propertyset>
  </target>

  <target name="doc-solvergen">
    <!-- Requires Doxygen v1.8+ and doxypy. -->
    <exec executable="doxygen" dir="${stamp.dir}/solvergen"
	  spawn="false" failonerror="true"/>
  </target>
</project>
